
<!-- HTML -->
<script type="text/x-red" data-template-name="switch-out">
    <div class="form-row">
        <label for="node-input-code"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-toggle" placeholder="Only" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-toggle" style="width: 70%;">Toggle</label>
    </div>
</script>
<script type="text/x-red" data-help-name="switch-out">
    <p>The node will convert the Norelite payload into a format that is applicable for the <a href="https://www.npmjs.com/package/node-red-contrib-home-assistant-websocket">node-red-contrib-home-assistant-websocket</a>&nbsp;"call service" node input format for switch devices. Use the node just before the "call service" node and leave <strong>service</strong> and&nbsp;<strong>data</strong> properties empty to accept the incoming message to steer the switch node.&nbsp;In&nbsp;<a href="https://www.npmjs.com/package/node-red-contrib-home-assistant-websocket">node-red-contrib-home-assistant-websocket</a>&nbsp;"call service" node&nbsp;<strong>domain</strong>&nbsp;(switch) and&nbsp;<strong>entity_id</strong> must be specified.</p>
    <p>Check&nbsp;<strong>toggle</strong> if you want each message to toggle the switch. The incoming message must still have&nbsp;<strong>msg.payload.enabled</strong> = true for the toggle to work, otherwise it will turn the switch off.</p>
    <p>Incoming message structure:</p>
    <pre>msg.payload = {<br />   // Identifier of sending node. Generated by norelite sending node<br />   "id": "851453b0.5262" <br /><br />   // Switch on or toggle or false if turn off<br />   "enabled":true,<br /><br />   // Not used but mandatory (standard in Norelite). Used to for prioritizing events<br />   "type": 0, <br /><br />   // Not used but mandatory<br />   "dim": 100<br /><br />   // Not used but mandatory<br />   "color": "#FFFFFF",<br /><br />   // Not used<br />   "transition": 1<br />}</pre>
    <p>Example</p>
    <pre>[{"id":"6243965.19b2968","type":"switch-out","z":"5c98d892.1f31c8","name":"test","toggle":true,"x":630,"y":820,"wires":[["564bf54.0772b0c"]]},{"id":"366c7317.48ddbc","type":"nrl-on in","z":"5c98d892.1f31c8","name":"","x":430,"y":820,"wires":[["6243965.19b2968"]]},{"id":"564bf54.0772b0c","type":"api-call-service","z":"5c98d892.1f31c8","name":"","server":"489cfd6a.7da324","version":1,"debugenabled":false,"service_domain":"switch","service":"","entityId":"switch.element_lisa","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":820,"wires":[[]]},{"id":"489cfd6a.7da324","type":"server","z":"","name":"Home Assistant","legacy":false,"addon":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true}]</pre>
</script>
<script type="text/javascript">
    RED.nodes.registerType('switch-out', {
        category: 'norelite_hass-output',
        color: "#34ebde",
        defaults: {
            name: {value: "", required: false},
            toggle: {value: false, required: true}
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-plug",
        align: "right",
        label: function() {
            return (this.name || "");
        }
    });
</script>
