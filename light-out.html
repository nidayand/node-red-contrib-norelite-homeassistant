
<!-- HTML -->
<script type="text/x-red" data-template-name="lights-out">
    <div class="form-row">
        <label for="node-input-code"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-toggle" placeholder="Only" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-toggle" style="width: 70%;">Toggle</label>
    </div>
</script>
<script type="text/x-red" data-help-name="lights-out">
    <p>
        <p>The node will convert the Norelite payload into a format that is applicable for the <a href="https://www.npmjs.com/package/node-red-contrib-home-assistant-websocket">node-red-contrib-home-assistant-websocket</a>&nbsp;"call service" node input format. Use the node just before the "call service" node and leave <strong>service</strong> and&nbsp;<strong>data</strong> properties empty to accept the incoming message to steer the light node.&nbsp;In&nbsp;<a href="https://www.npmjs.com/package/node-red-contrib-home-assistant-websocket">node-red-contrib-home-assistant-websocket</a>&nbsp;"call service" node&nbsp;<strong>domain</strong> and&nbsp;<strong>entity_id</strong> must be specified.</p>
        <p>Check&nbsp;<strong>toggle</strong> if you want each message to toggle the light. The incoming message must still have&nbsp;<strong>msg.payload.enabled</strong> = true for the toggle to work, otherwise it will turn the light off.</p>
        <p>Incoming message structure:</p>
        <pre>msg.payload = {<br />   // Identifier of sending node. Generated by norelite sending node<br />   "id": "851453b0.5262" <br /><br />   // Turn on or toggle<br />   "enabled":true,<br /><br />   // Not used but mandatory (standard in Norelite). Used to for prioritizing events<br />   "type": 0, <br /><br />   // Dim level 0-100<br />   "dim": 100<br /><br />   // Color in HEX-format<br />   "color": "#FFFFFF",<br /><br />   // Time in sec for transitioning between states. Optional. Default 1<br />   "transition": 1<br />}</pre>
        <p>Example</p>
        <pre>[{"id":"ee945841.7042a8","type":"lights-out","z":"5c98d892.1f31c8","name":"toggle","toggle":true,"x":850,"y":760,"wires":[["45d39af9.53ba04"]]},{"id":"45d39af9.53ba04","type":"api-call-service","z":"5c98d892.1f31c8","name":"","server":"489cfd6a.7da324","version":1,"debugenabled":false,"service_domain":"light","service":"","entityId":"light.hornlampa","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":760,"wires":[[]]},{"id":"d1772cf8.76074","type":"nrl-on in","z":"5c98d892.1f31c8","name":"","x":690,"y":760,"wires":[["ee945841.7042a8"]]},{"id":"60d9ea4e.002f24","type":"inject","z":"5c98d892.1f31c8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":760,"wires":[["84603727.cd7688"]]},{"id":"84603727.cd7688","type":"nrl-source out","z":"5c98d892.1f31c8","config":"1406c07f.76155","uid":"a465c37e-85ae-43ce-48d9-0086a3ff4177","name":"Enabled","def":"","expire":false,"timeout":100,"timeoutUnits":"seconds","expval":"false","output":false,"hysteresis":0,"toggle":false,"cycle":false,"cyclen":"3","outputs":0,"x":520,"y":800,"wires":[]},{"id":"aff3607d.3d33","type":"inject","z":"5c98d892.1f31c8","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":820,"wires":[["84603727.cd7688"]]},{"id":"6e4e2518.32962c","type":"nrl-eval in","z":"5c98d892.1f31c8","config":"1406c07f.76155","name":"Evaluate","rules":[{"s":"a465c37e-85ae-43ce-48d9-0086a3ff4177","t":"true"}],"checkall":"true","inputson":false,"outputdelay":true,"disablerepeat":false,"inputs":0,"x":680,"y":840,"wires":[["6cead8c3.0d8f88"]]},{"id":"2e39a5c4.3c19ea","type":"lights-out","z":"5c98d892.1f31c8","name":"","toggle":false,"x":1030,"y":840,"wires":[["45d39af9.53ba04"]]},{"id":"6cead8c3.0d8f88","type":"nrl-value in","z":"5c98d892.1f31c8","slider":"50","x":850,"y":840,"wires":[["2e39a5c4.3c19ea"]]},{"id":"489cfd6a.7da324","type":"server","z":"","name":"Home Assistant","legacy":false,"addon":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"1406c07f.76155","type":"nrl-config","z":"","delay":"5","name":""}]</pre>
    </p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('lights-out', {
        category: 'norelite_hass-output',
        color: "#34ebde",
        defaults: {
            name: {value: "", required: false},
            toggle: {value: false, required: true}
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-lightbulb-o",
        align: "right",
        label: function() {
            return (this.name || "");
        }
    });
</script>
